<!-- resolution 2532-1170 (2.164:1) iphone 13 std -->
<html>
    <body>
        <canvas width="700" height="323"></canvas>
        <div style="display:none;">
            <img id="bg" src="desert.png" width="700" height="323">
            <img id="cactus" src="cactus.png" width="50" height="80">
            <img id="balloon" src="balloon.png" width="50" height="100">
          </div>

        <script>
            function rr(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            let colors = ['red', 'green', 'blue', 'yellow', 'orange', 'purple', 'brown', 'black', 'white'];
            let circles = [];
            let points = 0;

            function drawCircles(canvas, context) {
                const w = canvas.width;
                const h = canvas.height;

                context.save();
                
                circles.forEach( e => {
                    // context.beginPath();
                    // context.arc(e.x, e.y, e.radius, 0, Math.PI*2);
                    // context.lineWidth = e.linewidth;
                    // context.strokeStyle = e.color;
                    // context.stroke();
                    const image = document.getElementById('cactus');
                    
                    context.drawImage(image, e.x, e.y, image.width * e.factor, image.height * e.factor);
                });

                context.restore();
            }

            let balloon = { x: 50, y: 300, size: 20 };
            function drawBalloon(canvas, context) {
                context.save();

                const image = document.getElementById('balloon');
                context.drawImage(image, balloon.x, balloon.y, image.width, image.height);

                context.restore();
            }

            function drawGame() {
                let canvas = document.querySelector('canvas');
                let context = canvas.getContext('2d');

                const w = canvas.width;
                const h = canvas.height;

                //context.clearRect(0, 0, w, h);
                
                context.save();
                context.fillStyle = '#cccccc';
                context.fillRect(0, 0, w, h);
                context.restore();

                context.drawImage(document.getElementById('bg'), 0, 0, w, h);

                drawCircles(canvas, context);
                drawBalloon(canvas, context);
            }

            function addCircle(x, y, radius, color, linewidth) {
                circles.push({
                   x: x,
                   y: y,
                   radius: radius,
                   linewidth : linewidth,
                   color: color,
                   factor: rr(1,3)
                });
            }

            function onCanvasClick(e) {
                addCircle(e.x, e.y, rr(10, 80), colors[rr(0, colors.length - 1)], rr(1, 5));
                drawGame();
            }

            function onKeyDown(e) {
                e = e || window.event;
                console.log(e);

                switch( e.key ) {
                    case 'ArrowUp':
                    case 'w':
                        balloon.y -= 10;
                        break;
                    
                    case 'ArrowDown':
                    case 's':
                        balloon.y += 10;
                        break;
                    
                    case 'ArrowLeft':
                    case 'a':
                        balloon.x -= 10;
                        break;
                    
                    case 'ArrowRight':
                    case 'd':
                        balloon.x += 10;
                        break;

                    case ' ':
                        balloon.y -= 10;
                        break; 
                }
                
                drawGame();
                return true;
            }

            function init() {
                let canvas = document.querySelector('canvas');
                const w = canvas.width;
                const h = canvas.height;

                canvas.addEventListener("mousedown", onCanvasClick);
                document.addEventListener("keyup", e => onKeyDown(e));

                setInterval(() => {
                    circles.forEach( c => {
                        c.x -= 3;
                    });
                    drawGame();
                }, 50);

                setInterval(() => { 
                    if (rr(1,16)%7) { 
                        addCircle(w, h-160, 20, 'red', 5);
                        drawGame();
                    }
                }, 2000);
                
                setInterval( () => {
                    balloon.y = Math.min( balloon.y + 15, h );
                    drawGame();
                }, 500);
            }

            init();
            drawGame();

        </script>
    </body>
</html>